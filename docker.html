docker学习

一：
	镜像（image）:
		docker好比一个模板，通过这个模板来创建一个容器，tomcat镜像==》run==>容器（提供服务）
		一个镜像可以创建多个容器（服务就是运行在容器中）
	容器（container）：
		docker容器技术，独立运行一个或者一组应用，通过镜像来创建
		启动 停止 删除 基本命令
	仓库(repository):
		仓库存放镜像得地方
		
二：安装docker ubuntu16.04（参考docker官方地址https://docs.docker.com/engine/install/ubuntu/）
	1,
		sudo apt-get remove docker docker-engine docker.io containerd runc
	2,
		sudo apt-get update
	3,
		sudo apt-get install \
		apt-transport-https \
		ca-certificates \
		curl \
		gnupg-agent \
		software-properties-common	
	4,
		curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
	5,
		sudo apt-key fingerprint 0EBFCD88
	6,	配置镜像	
		sudo add-apt-repository \
	   "deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable \
	   $(lsb_release -cs) \
	   stable"
   7，安装docker
   		sudo apt-get update

		sudo apt-get install docker-ce docker-ce-cli containerd.io

	8, docker version验证是否成功

三，配置阿里云镜像
	esc --> 容器镜像服务-->配置镜像加速器
		选择对应版本执行下述命令
		sudo mkdir -p /etc/docker

		sudo tee /etc/docker/daemon.json <<-'EOF'   --fdffafafasfa这个尖括号没有任何意义，为了不变色>
		{
		  "registry-mirrors": ["https://0cgkxyo8.mirror.aliyuncs.com"]
		}
		EOF

		sudo systemctl daemon-reload

		sudo systemctl restart docker

四 ，
	1，docker操作
		systemctl run docker/systemctl stop docker/systemctl status docker/sudo systemctl restart docker			
	3，运行镜像
		docker run hello-world
	4，镜像常用命令
		docker version
		docker info
		docker --help 
		docker images [镜像名称]
		docker images --help 可以查看带哪些参数
		docker search [镜像名称]  搜索镜像
		docker search [镜像名称] --filter=STARS=3000
		docker pull [镜像名称] 默认是latest最近版本
		docker pull [镜像名称]:5.7
		docker rmi -f [镜像id] 强制删除
		docker rmi -f $(docker images -aq) 批量删除 $:代表参数
	5，容器常用命令
		有镜像才可以创建容器
		eg:以centos为例
			1，docker pull centos 下载
			2，docker run [可选参数] image
				参数说明
				-name="Name" 容器名字 tomcat01 tomcat02用来区分容器
				-d			 后台方式运行
				-it			 使用交互方式运行，可进入容器查看
				-p			 指定容器端口 -p 8080:8080
					-p ip:主机端口：容器端口
					-p 主机端口：容器端口(常用)
					-p 容器端口
				-P			随机指定端口
		    3，测试，启动并进入容器
				docker run -it centos /bin/bash
			4, 退出容器
				exit 停止容器的退出，ctrl+P+Q后台运行退出
			5, 列出所有运行容器
				docker ps [可选参数]
					-a 列出所有容器
					-q 列出容器id
					-n=? 最近运行的容器
				docker ps 列出正在运行的容器
				docker ps -a 列出曾经运行的容器
			6, 删除
				docker rm [容器id] （不能删除正在运行的程序）
				docker rm -f [容器id] 强制删除
				docker rm $(docker ps -aq) 批量删除容器
				docker ps -a -q | xargs docker rm 批量删除所有容器
			7，docker stop [容器id] 停止容器
			   docker start [容器id] 启动一个run之后镜像容器
			   docker restart [容器id] 重启容器
			   docker kill [容器id]  强制停止一个容器
	6, 常用其他命令
		启动centos 如果是-d运行，前台要启一个进程，不然启动就停止
		跟一段shell脚本
		docker run -d centos /bin/bash -c "while true;do echo lckstudy;sleep 1; done"
		docker logs -tf [容器id] 显示所有日志
		docker logs -tf --tail n [容器id] 显示最近n条的日志
		docker inspect [容器id] 查看容器运行的信息
		docker top [容器id] 查看容器运行进程相关信息
		docker exec -it [容器id] /bin/bash 进入正在运行的容器，可以对容器进行一些配置
		docker attach [容器id] 进入正在执行的终端
		docker cp 容器id:/路径 /主机路径  从容器内部拷贝到主机
			docker cp 25cf8d1da79a:/home/lck.java /home
	7，练习
		1，安装nginx
			docker search nginx
			docker pull nginx
			docker run -d(后台运行) --name(自定义一个名字) -p 映射宿主机端口跟容器端口 镜像名称
			docker run -d --name nginx01 -p 3389:80 nginx
		2，安装tomcat
			docker pull tomcat
			由于tomcat是瘦身版的  需要将webapps.dist 复制到webapps目录下
			docker run -d --name tomcat01 -p 8888:8080 tomcat
		3, 安装es+kibana
			docker search elasticsearch
			docker pull elasticsearch
			docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" elasticsearch:tag
			指定内存启动文件
			docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" -e ES_JAVA_OPTS="Xms64m Xmx512m" elasticsearch:tag		
		4, docker stats查看cpu状态
		5, 安装portainer可视化工具
			docker run -d -p 9999:9000 \--restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer
	8，容器制作成镜像
		docker commit -m="提交一个描述信息" -a="作者" 容器id 目标镜像名:tag
		docker commit -m="制作tomcat镜像" -a="lck" [容器id] tomcat_lck:1.0(记得带版本号)

五，docker核心部分
	1，容器的卷技术
		docker run -it -v 宿主机目录:容器目录
		docker run -it -v /home/test:/home centos /bin/bash
	安装mysql挂在数据库文件
		docker run -d --name mysql01 -p 3389:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v/home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7
		
		-v：宿主机目录:容器目录(可以挂在多个)
		-e: mysql需要配置密码才可以连接
		-d: 后台运行
		--name: 容器名字
	2，具名挂载&匿名挂载
		docker volume ls 查看所有挂在
		匿名挂在不指定宿主机的目录的挂在情况
		docker run -d --name nginx01 -v /etc/nginx nginx:ro
		具名挂载,随机指定挂在名
		docker run -d --name nginx01 -v lck:/etc/nginx nginx:rw
		指定宿主机路径的挂在
		docker run -d --name nginx01 -v /home:/etc/nginx nginx
		可以通过
		docker volume inspect 挂在名（可以通过docker volume ls查看 ）
		
		ro:readonly 容器内部只读（只能通过宿主机来操作写功能）
		rw:容器内可读可写
	3，数据卷之Dockerfile创建镜像
		一个centos为例
		1,touch Dockerfile
		2,编辑文件vim
			FROM centos
			volume ["volume1","volume2"] (匿名挂在)
			CMD echo "----end----"
			CMD /bin/bash
		3,编译
			docker build -f /Dcokerfile全路径/Dockerfile -t centos1.0(打包之后的镜像名) . (一定不能丢表示当前路径)
		4，运行
			docker run -it centos:1.0 /bin/bash

	4，容器之间的挂载
		centos为例子
		docker run -it --name centos01 centos(image镜像名称)
		docker run -it --name --volumes-from centos01(要挂载的镜像) centos(image镜像名称)
		--volumes-from 容器id 表示容器之间的挂载
六，DockerFile
		1,编写一个dockerfile文件
		2，docker build 构建一个镜像
		3，docker run 运行镜像
		4，docker push 发布镜像（DockerHub,阿里云镜像仓库）
	基础知识
		1，每个保留的关键字（指令）都必须是大写字母
		2，执行从上到下执行
		3，#表示注释
		4，每一个指令都会提交一个新镜像层，并提交
		5，DockerFile，构建文件定义了一切步骤，源代码
		6，DockerImages,通过DokcerFile来生成镜像，最终发布和运行产品
		7，Docker容器，容器就是镜像运行起来提供服务
	DockerFile命令
		From:				#镜像基础，一切从这里开始构建 
		MAINTAINER:			#镜像是谁写的 姓名+邮箱
		RUN:				#镜像构建的时候需要运行的命令
		ADD:				#步骤，tomcat镜像，这个tomcat压缩包，添加内容用
		WORKDIR:			#镜像的工作目录
		VOLUME:				#挂载的目录
		EXPOSE:				#暴露的端口
		CMD:				#指定这个容器的时候要运行的命令，只有最后一个生效，可被替代
		ENTRYPOINT:			#指定这个容器的时候要运行的命令，可以追加
		ONBUILD:			#当构建一个被继承的DockerFile这个时候就会运行ONBUILD的指令，触发指令
		COPY:				#类似ADD，将我们文件拷贝到镜像中
		ENV:				#构建的时候设置环境变量
	通过DockerFile制作centos自定义镜像
		FROM centos
		MAINTAINER lck<lck@qq.com>

		ENV MYPATH /usr/local
		WORKDIR $MYPATH

		RUN yum -y install vim
		RUN yum -y install net-tools

		EXPOSE 80

		CMD echo $MYPATH
		CMD echo -------lck-create-succussful-----
		CMD /bin/bash
		构建镜像
		docker build -f Dockerfile -t my_cnetos .
	制作tomcat+jdk+centos镜像
		1，准备jdk,tomcat压缩文件
		2，编写Dockerfile文件
		3，编译镜像docker build -f Dockerfile -t 镜像名称（随意起）
		4，运行镜像 docker run -d -P --name 容器名称（随意起） 镜像名
			dockerfile文件
				FROM centos
				MAINTAINET lck<123@com>
				COPY readme.txt /usr/local/readme.txt

				ADD jdk-811-linux-x64.tar.gz /usr/local/
				ADD appache-tomcat-9.0.22.tar.gz /usr/local/

				RUN yun -y install vim

				ENV MYPATH /usr/local
				WORKDIR $MYPATH

				ENV JAVA_HOME /usr/local/jdk1.8.0_11
				ENV CLASS_PATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
				ENV CATALINA_HOME /usr/local/appache-tomcat-9.0.22
				ENV CATALINA_BASH /usr/local/appache-tomcat-9.0.22
				ENV PATH $PATH:$JAVA_HOME/bin:$JAVA_HOME/lib:$CATALINA_HOME/bin

				EXPOST 8080

				CMD /usr/local/appache-tomcat-9.0.22/bin/startup.sh && tail -F /usr/local/appache-tomcat-9.0.22/bin/logs/catalina.out
七 , dokcer hub.docker&阿里云
	hub.docker官网注册账号
	命令行登录
		docker login -u userNmae -p password
	镜像打标签
		docker tag [目标镜像名/镜像id]  注册的用户名/打成镜像名:tag
		docker tag tomcat_lck:1.0 userName/tomcat_lck:2.0
	上传
		docker push 注册的用户名/打成镜像名:tag
		docker push userName/tomcat_lck:2.0

八，docker网络
	1,eg:
		运行一个镜像
			docker run -d --name tomcat01 tomcat
		查看容器ip信息
			docker exec -it tomcat01 ip addr
		docker容器之间的ping
			进入容器tomcat01 ping 另外一个ip
		   docker exec -it tomcat01 ping 172.17.0.3
	2,容器通过网名互联link(不推荐使用)
		docker run -d --name tomcat04 --link tomcat03 tomcat
	3,自定义网络
		docker network 查看docker网络
		创建一个docker 网络
			docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet
			--driver bridge :桥接模式
			--subnet		:子网掩码 /16表示可以255*255-1种可能
			--gateway		:网关
			mynet			:表示自定义名字
		启动一个容器验证一下容器互通情况
			docker run -d --name tomcat_net_01 --net mynet tomcat
			--net mynet :表示网络
			docker run -d --name tomcat_net_02 --net mynet tomcat
		验证联通情况
			docker exec -it tomcat_net_01 ping tomcat_net_02
			docker exec -it tomcat_net_02 ping tomcat_net_01
	4，docker容器连接一个网络
		docker network connect 网络名称 容器id
		docker network connect mynet tomcat_my_net

九，redis集群部署

十，springboot镜像制作
	1，架构springboot项目
	2，打包应用
	3，编写dockerfile
	4，构建镜像 docker build -f dockerfile -t lck_springboot .
	5, 发布运行 docker run -d --name springboot_pack lck_springboot	
		
	
